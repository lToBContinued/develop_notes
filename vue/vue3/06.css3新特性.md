# css3 新特性

## 样式穿透

> 主要是用于修改很多vue常用的组件库（element, vant, AntDesigin），虽然配好了样式但是还是需要更改其他的样式就需要用到样式穿透

### scoped

#### scoped的原理

vue中的scoped 通过在DOM结构以及css样式上加唯一不重复的标记:data-v-hash的方式，以保证唯一（而这个工作是由过PostCSS转译实现的），达到样式私有化模块化的目的。

总结一下scoped三条渲染规则：

```vue
<template>
  <main>
    <el-input placeholder="测试代码" class="inp"></el-input>
  </main>
</template>

<script setup lang="ts"></script>

<style scoped lang="scss">
.inp {
  width: 240px;
  margin: 10px;
}
</style>
```

1. 给HTML的DOM节点加一个不重复data属性(形如：data-v-123)来表示他的唯一性
[![pEEEfht.png](https://s21.ax1x.com/2025/01/24/pEEEfht.png)](https://imgse.com/i/pEEEfht)
2. 在每句css选择器的末尾（编译后的生成的css语句）加一个当前组件的data属性选择器（如[data-v-123]）来私有化样式
[![pEEE49P.png](https://s21.ax1x.com/2025/01/24/pEEE49P.png)](https://imgse.com/i/pEEE49P)
3. 如果组件内部包含有其他组件，只会给其他组件的最外层标签加上当前组件的data属性
[![pEEEv90.png](https://s21.ax1x.com/2025/01/24/pEEEv90.png)](https://imgse.com/i/pEEEv90)

> 注：这里 2 和 3 在一些情况下会产生冲突

例：想修改输入框背景颜色

```vue
<template>
  <main>
    <el-input placeholder="测试代码" class="inp"></el-input>
  </main>
</template>

<script setup lang="ts"></script>

<style scoped lang="scss">
.inp {
  width: 240px;
  margin: 10px;

  /* 修改输入框背景颜色 */
  .el-input__inner {
    background-color: red;
  }
}
</style>
```

以上的代码无法成功修改，原因是由于使用了 scoped，因此在 css 编译后的 .el-input\__inner 选择器的末尾被添加上了 data-v-hash （参考第二条），而又由于第三条，导致 dom 中的元素身上并没有对应的 data-v-hash 属性，因此名为 el-input__inner 的元素无法被选中，修改不了样式。

[![pEEVD5n.png](https://s21.ax1x.com/2025/01/24/pEEVD5n.png)](https://imgse.com/i/pEEVD5n)

此时需要使用**样式穿透**。

### :deep()

原理：将属性选择器挪了一下位置，属性选择器跟在谁的后面，就挪到哪

```vue
<style scoped lang="scss">
.inp {
  width: 240px;
  margin: 10px;

  :deep(.el-input__inner) {
    background-color: red;
  }
}
</style>
```

[![pEEVsCq.png](https://s21.ax1x.com/2025/01/24/pEEVsCq.png)](https://imgse.com/i/pEEVsCq)

## 插槽选择器

### 问题

在父组件中使用插槽后，在子组件中修改插槽传进来的 dom 的样式不会生效

App.vue

```vue
<template>
  <A>
    <div class="a">私人订制DIV</div>
  </A>
</template>

<script setup lang="ts">
import A from '@/components/A.vue'
</script>

<style scoped></style>
```

A.vue

```vue
<template>
  <div>
    我是插槽
    <slot></slot>
  </div>
</template>

<script setup lang="ts"></script>

<style scoped lang="scss">
.a {
  color: red;
}
</style>
```

此时“私人订制DIV”几个字并没有变成红色，解决办法是使用插槽选择器

[![pEE8Y24.png](https://s21.ax1x.com/2025/01/25/pEE8Y24.png)](https://imgse.com/i/pEE8Y24)

### :slotted() 插槽选择器

在子组件中使用插槽选择器可以修改插槽里面的样式

A.vue

```vue
<template>
  <div>
    我是插槽
    <slot></slot>
  </div>
</template>

<script setup lang="ts"></script>

<style scoped lang="scss">
.a {
  color: red;
}
</style>
```

此时插槽中的字体变为红色

[![pEE8Ba6.png](https://s21.ax1x.com/2025/01/25/pEE8Ba6.png)](https://imgse.com/i/pEE8Ba6)

## 全局选择器（慎用）

在带有 scoped 的样式标签中更改全局样式

```vue
<template>
  <A>
    <div class="a">私人订制DIV</div>
  </A>
</template>

<script setup lang="ts">
import A from '@/components/A.vue'
</script>

<style scoped lang="scss">
:global(div) {
  color: red;
}
</style>
```

所有的div中的字体都会变成红色

## 动态 css

在 style 标签中可以使用 v-bind 来绑定脚本中的变量

```vue
<template>
  <div class="div">动态css</div>
</template>

<script setup lang="ts">
import { ref } from 'vue'

const style = ref('red')
</script>

<style scoped lang="scss">
.div {
  color: v-bind(style);
}
</style>
```

也可以将 style 变量写成对象的形式，此时在 style 标签中引用时需要加单引号

```vue
<template>
  <div class="div">动态css</div>
</template>

<script setup lang="ts">
import { ref } from 'vue'

const style = ref({
  color: 'red'
})
</script>

<style scoped lang="scss">
.div {
  color: v-bind('style.color');
}
</style>
```

字体在两秒后会从红色变成蓝色

```vue
<template>
  <div class="div">动态css</div>
</template>

<script setup lang="ts">
import { ref } from 'vue'

const style = ref({
  color: 'red',
})

setTimeout(() => {
  style.value.color = 'blue'
}, 2000)
</script>

<style scoped lang="scss">
.div {
  color: v-bind('style.color');
}
</style>
```

## css module

### 添加单个类样式

在 style 标签上加上 module 属性，在模板中使用动态绑定 **:class="$style.xxxx"**

```vue
<template>
  <div :class="[$style.div]">动态css</div>
</template>

<style scoped lang="scss" module>
.div {
  color: red;
}
</style>
```

### 添加多个类样式

将模板中动态绑定的 :class 的值写成数组的形式

```vue
<template>
  <div :class="[$style.div, $style.border]">动态css</div>
</template>

<style scoped lang="scss" module>
.div {
  color: red;
}

.border {
  border: 1px solid #ccc;
}
</style>
```

### 自定义 module 名字

给 module 起名后，模板中相应的 $style 需要替换成起的名字

```vue
<template>
  <div :class="[zs.div, zs.border]">动态css</div>
</template>

<style scoped lang="scss" module="zs">
.div {
  color: red;
}

.border {
  border: 1px solid #ccc;
}
</style>
```

### 自定义hooks

使用 useCssModule 获取 module 内容

```vue
<template>
  <div :class="[zs.div, zs.border]">动态css</div>
</template>

<script setup lang="ts">
import { useCssModule } from 'vue'

const css = useCssModule('zs')
console.log(css)
</script>

<style scoped lang="scss" module="zs">
.div {
  color: red;
}

.border {
  border: 1px solid #ccc;
}
</style>
```

[![pEE87Rg.png](https://s21.ax1x.com/2025/01/25/pEE87Rg.png)](https://imgse.com/i/pEE87Rg)

> 使用场景：使用 render 函数或者使用 tsx 的场景
