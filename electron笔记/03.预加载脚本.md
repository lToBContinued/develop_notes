# 预加载脚本

## 基本使用

Electron 的预加载脚本是在渲染进程中运行的一段 js 代码，用于在主进程和渲染进程之间建立安全的桥梁。

**作用**：

1. 暴露有限的 Node.js API：预加载脚本可以在渲染进程中安全地暴露部分 Node.js API 或自定义方法，避免直接访问全部 Node.js API 带来的安全隐患。
2. 进程间通信：通过预加载脚本，渲染进程可以与主进程进行通信，实现数据交换和功能调用。
3. 增强安全性：通过限制渲染进程的权限，预加载脚本能有效防止恶意代码的执行。

### 预加载脚本运行在渲染进程中

main.js

```js
const {app, BrowserWindow} = require('electron')
const path = require('path')

const createWindow = () => {
  const app = new BrowserWindow({
    width: 1000,
    height: 600,
    webPreferences: {
      // 预加载脚本的引入路径必须是绝对路径
      preload: path.resolve(__dirname, './preload.js')
    }
  })
  app.webContents.openDevTools()
  app.loadFile('index.html')
}

app.whenReady().then(() => {
  createWindow()
})
```

preload.js

```js
console.log('预加载脚本') // 这行代码会在渲染进程中打印
```

[![pEKwTrn.png](https://s21.ax1x.com/2025/02/15/pEKwTrn.png)](https://imgse.com/i/pEKwTrn)

## contextBridge

contextBridge 是 Electron 提供的一个 API，用于安全地在主进程和渲染进程之间传递数据和功能。它的主要作用是解决 Electron 应用中的安全性问题，尤其是在启用 contextIsolation（上下文隔离）时。

使用 contextBridge 定义一个全局变量

preload.js

```js
const { contextBridge } = require('electron')

// 使用 contextBridge 暴露一个全局变量
contextBridge.exposeInMainWorld('myApi', {
  platform: process.platform
})
```

全局变量被保存在 window 对象中

```js
console.log(window.myApi)
console.log(window.myApi.platform)
```
