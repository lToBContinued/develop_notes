# 创建一个 electron 项目

## 安装 electron

```bash
npm i electron -D
```

## 创建一个入口文件

在根目录下创建一个 main.js 文件，并将 package.json 中的 “main” 的值改为 “main.js”

> 入口文件的名字可以随便取

## 创建第一个应用窗口

创建一个 800 * 600 的窗口

main.js

```js
// app 用于管理应用程序的生命周期。
// BrowserWindow 用于创建和控制应用程序的窗口。
import { app, BrowserWindow } from 'electron'

// 创建一个应用窗口
const createWindow = () => {
  // 创建一个窗口实例
  const win = new BrowserWindow({
    width: 800, // 窗口宽度
    height: 600, // 窗口高度
  })
}

// app.whenReady() 返回一个 Promise，当 Electron 应用程序完成初始化并准备好创建窗口时，这个 Promise 会被解析（resolve）
app.whenReady().then(() => {
  createWindow() // 创建窗口
})
```

在 package.json 中添加运行 electron 的命令  "start": "electron ."

```json
{
  "scripts": {
    "start": "electron ."
  },
}
```

执行 npm run start，运行代码

[![pEmg4tP.png](https://s21.ax1x.com/2025/02/08/pEmg4tP.png)](https://imgse.com/i/pEmg4tP)

> 使用 nodemon 可以在开发的时候开启热更新代码

修改 package.json 文件

--watch ./ 监控根目录下的所有文件
--ext .js,html,.css,.vue 监控符合这些文件扩展名的文件的变化

```json
"scripts": {
  "start": "nodemon --exec electron . --watch ./ --ext .js,html,.css,.vue"
},
```

再次执行 npm run start

## 引入网页

### 引入线上网页

使用 loadURL 加载一个网页

```js
import { app, BrowserWindow } from 'electron'

const createWindow = () => {
  const win = new BrowserWindow({
    width: 800,
    height: 600,
  })

  // loadURL 是 BrowserWindow 实例的一个方法，用于加载指定的 URL 或文件路径。
  // 加载并显示 https://www.bilibili.com 这个网页的内容
  win.loadURL('https://www.bilibili.com')
}

app.whenReady().then(() => {
  createWindow()
})
```

[![pEm2m9K.png](https://s21.ax1x.com/2025/02/08/pEm2m9K.png)](https://imgse.com/i/pEm2m9K)

### 引入本地网页

index.html

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
  <h1>hello</h1>
</body>
</html>
```

main.js

```js
import { app, BrowserWindow } from 'electron'

const createWindow = () => {
  const win = new BrowserWindow({
    width: 800,
    height: 600,
  })

  // loadFile 是 BrowserWindow 实例的一个方法，可以加载本地的 HTML 文件
  win.loadFile('./index.html')
}

app.whenReady().then(() => {
  createWindow()
})
```

[![pEm2t9f.png](https://s21.ax1x.com/2025/02/08/pEm2t9f.png)](https://imgse.com/i/pEm2t9f)

## 管理应用的窗口生命周期

应用窗口在不同操作系统中的行为也不同。 Electron 允许您自行实现这些行为来遵循操作系统的规范，而不是采用默认的强制执行。 您可以通过监听 app 和 BrowserWindow 模组的事件，自行实现基础的应用窗口规范。

> 通过检查 Node.js 的 process.platform 变量，您可以针对特定平台运行特定代码。 请注意，Electron 目前只支持三个平台：win32 (Windows), linux (Linux) 和 darwin (macOS) 。

### 关闭所有窗口时退出应用

在 Windows 和 Linux 上，我们通常希望在关闭一个应用的所有窗口后让它退出。

```js
app.on('window-all-closed', () => {
  // 当所有窗口都被关闭时，执行以下代码
  if (process.platform !== 'darwin') {
    // 如果当前平台不是 macOS（darwin），则退出应用程序
    app.quit()
  }
})
```

### 如果没有窗口打开则打开一个窗口

与前二者相比，即使没有打开任何窗口，macOS 应用通常也会继续运行。在没有窗口可用时调用 app 会打开一个新窗口。

因为窗口无法在 ready 事件前创建，你应当在你的应用初始化后仅监听 activate 事件。 要实现这个，仅监听 whenReady() 回调即可。

```js
app.whenReady().then(() => {
  createWindow()
  
  app.on('activate', ()=>{
    // 当应用程序被激活时，执行以下代码
    if (BrowserWindow.getAllWindows().length === 0) {
      // 如果当前没有打开的窗口，则创建一个新窗口
      createWindow()
    }
  })
})
```

## 完整实现代码

```js
import { app, BrowserWindow } from 'electron'

const createWindow = () => {
  const win = new BrowserWindow({
    width: 800,
    height: 600,
  })
  
  win.loadFile('./index.html')
}

app.whenReady().then(() => {
  createWindow()
  
  app.on('activate', ()=>{
    if (BrowserWindow.getAllWindows().length === 0) {
      createWindow()
    }
  })
})

app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') {
    app.quit()
  }
})
```

## 辅助开发操作

### 打开开发者工具

main.js

```js
const createWindow = () => {
  const win = new BrowserWindow({
    width: 1000,
    height: 600,
  })
  win.webContents.openDevTools() // 打开开发者工具
  win.loadFile('index.html')
}
```
